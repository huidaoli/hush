tinymce.PluginManager.add('ylink', function(editor, url) {
	
	// body
	var plug_name = 'Link Manager';
	var plug_tips = '链接管理工具';
	var win_body = [
	{type:'notification', text:'只允许添加固定网址的链接', style:'width:458px;top:10px;'},
	{type:'spacer', style:'height:5px;'},
	{type:'textbox', name:'link', label:'链接地址'},
	{type:'textbox', name:'text', label:'链接文字'}
	];
	
	// Add a button that opens a window
	editor.addButton('ylink', {
		text : '',
		icon : 'link',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/hush/ylink', {
						'link' : e.data.link
					}, function(r) {
						if (r.err == '0') {
							var link = r.msg;
							if (e.data.text) {
								editor.insertContent(editor.dom.createHTML("a", { href : link }, editor.dom.encode(e.data.text)));
							} else {
								editor.execCommand('mceInsertLink', false, link);
							}
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	// Adds a menu item to the tools menu
	editor.addMenuItem('ylink', {
		text : plug_name,
		context : 'tools',
		tooltip : plug_tips,
		onclick : function() {
			// Open window
			editor.windowManager.open({
				title : plug_name,
				body : win_body,
				width : 500,
				height : 180,
				onsubmit : function(e) {
					// Insert content when the window form is submitted
					$.post('/hush/ylink', {
						'link' : e.data.link
					}, function(data) {
						if (r.err == '0') {
							var link = r.msg;
							if (e.data.text) {
								editor.insertContent(editor.dom.createHTML("a", { href : link }, editor.dom.encode(e.data.text)));
							} else {
								editor.execCommand('mceInsertLink', false, link);
							}
						} else {
							alert(r.msg);
						}
					}, 'json');
				}
			});
		}
	});

	return {
		getMetadata : function() {
			return {
				title : plug_name
			};
		}
	};
});